<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Top Outlet Perfume</title>
    <link rel="icon" type="image/png" href="icon/32.png" />
    <link rel="apple-touch-icon" href="icon/180.png" />

    <style>
      /* ================= 1. ÂÖ®Â±ÄÈÖçÁΩÆ ================= */
      :root {
        --header-height: 60px;
        --sidebar-width: 300px;
        --accent-color: #b28900;
        --bg-color: #f8f8f8;
        --font-main: "Helvetica Neue", Helvetica, Arial, sans-serif;

        /* Ê†áÁ≠æÈ¢úËâ≤ÈÖçÁΩÆ */
        --tag-hot: #d9534f;
        --tag-new: #007bff;
        --tag-sale: #28a745;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        margin: 0;
        padding: 0;
        padding-top: var(--header-height);
        padding-bottom: 50px; /* Â∫ïÈÉ®Á©∫Èó¥ÔºåÈò≤Ê≠¢Ë¢´ÊâãÊú∫Â∫ïÈÉ®Ë¶ÜÁõñ */
        font-family: var(--font-main);
        background-color: var(--bg-color);
        color: #333;
      }

      /* ================= 2. Â§¥ÈÉ® (Header) ================= */
      #header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--header-height);
        background-color: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        padding: 0 15px;
        z-index: 1000;
      }

      #header-logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--accent-color);
        cursor: pointer;
        text-decoration: none;
        flex-grow: 1;
      }

      #search-container {
        display: flex;
        align-items: center;
        margin-right: 15px;
      }

      #search-input {
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 4px 0 0 4px;
        font-size: 1rem;
        width: 150px;
        transition: width 0.3s ease;
      }

      #search-input:focus {
        width: 200px;
        border-color: var(--accent-color);
        outline: none;
      }

      #search-button {
        background-color: var(--accent-color);
        color: white;
        border: 1px solid var(--accent-color);
        border-left: none;
        padding: 8px 12px;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
        font-size: 1rem;
      }
      #search-button:hover {
        opacity: 0.9;
      }

      .icon-button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
        position: relative;
        color: #333;
      }
      .icon-button:hover {
        color: var(--accent-color);
      }

      #header-cart-count {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: #d9534f;
        color: white;
        border-radius: 50%;
        padding: 2px 6px;
        font-size: 0.7rem;
        line-height: 1;
      }

      /* ================= 3. ‰æßËæπÊ†è (Sidebar Menu) ================= */
      #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: var(--sidebar-width);
        height: 100%;
        background-color: #fff;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        padding-top: var(--header-height);
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 999;
        overflow-y: auto;
      }

      #sidebar.open {
        transform: translateX(0);
      }

      .menu-item {
        padding: 12px 20px;
        cursor: pointer;
        display: block;
        text-decoration: none;
        color: #333;
        font-size: 1.1rem;
        border-bottom: 1px solid #eee;
      }

      .menu-item:hover,
      .menu-item.active {
        background-color: var(--bg-color);
        color: var(--accent-color);
      }
      .menu-item.highlight {
        font-weight: bold;
        color: var(--tag-sale);
      }

      /* ================= 4. ‰∏ªÂÜÖÂÆπÂå∫ (Main Content) ================= */
      #main-content {
        padding: 20px;
      }

      /* --- Home View (È¶ñÈ°µ) --- */
      .brand-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .brand-card {
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        text-align: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .brand-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .brand-name {
        font-weight: bold;
        margin-top: 5px;
        color: #555;
      }

      .section-title {
        font-size: 1.8rem;
        font-weight: bold;
        color: #333;
        margin: 30px 0 15px;
        border-bottom: 2px solid #ddd;
        padding-bottom: 5px;
      }

      /* --- Grid View (ÂàóË°®È°µ) --- */
      #grid-title {
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 20px;
        color: #333;
      }

      #product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
      }

      .product-card {
        background-color: white;
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: box-shadow 0.3s;
        position: relative;
        cursor: pointer;
      }
      .product-card:hover {
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }

      .product-img {
        width: 100%;
        height: 200px;
        object-fit: contain;
        border-radius: 4px;
        margin-bottom: 10px;
      }

      .product-brand {
        font-size: 0.9rem;
        color: #999;
        margin-bottom: 4px;
      }

      .product-name {
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 8px;
        min-height: 44px; /* ‰øùËØÅ‰∏§Ë°åÈ´òÂ∫¶‰∏ÄËá¥ */
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .product-price {
        font-size: 1.4rem;
        color: var(--tag-hot);
        font-weight: bold;
        margin-bottom: 10px;
      }

      .product-tags {
        position: absolute;
        top: 10px;
        left: 10px;
        display: flex;
        gap: 5px;
      }

      .tag {
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: bold;
        color: white;
      }
      .tag-hot {
        background-color: var(--tag-hot);
      }
      .tag-new {
        background-color: var(--tag-new);
      }
      .tag-sale {
        background-color: var(--tag-sale);
      }

      /* ================= 5. ÂàÜÈ°µ (Pagination) ================= */
      #pagination-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 30px;
      }

      #pagination-controls button {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 10px 15px;
        margin: 0 5px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
      }
      #pagination-controls button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }
      #pagination-controls span {
        font-weight: bold;
        padding: 0 10px;
      }

      /* ================= 6. Ê®°ÊÄÅÊ°Ü (Modal) ================= */
      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.7);
        padding-top: 60px;
      }
      .modal.show {
        display: block;
      }

      .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border-radius: 8px;
        max-width: 600px;
        position: relative;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        position: absolute;
        top: 10px;
        right: 20px;
      }
      .close-button:hover,
      .close-button:focus {
        color: #333;
        text-decoration: none;
      }

      #modal-product-details {
        display: flex;
        gap: 20px;
        align-items: flex-start;
      }

      #modal-product-img {
        width: 150px;
        height: 150px;
        object-fit: contain;
        border-radius: 4px;
        flex-shrink: 0;
      }

      .modal-text h2 {
        margin-top: 0;
        margin-bottom: 5px;
        font-size: 1.8rem;
        line-height: 1.2;
      }
      .modal-text p {
        margin: 5px 0;
        font-size: 1rem;
        color: #555;
      }
      .modal-text .price {
        font-size: 1.6rem;
        color: var(--tag-hot);
        font-weight: bold;
        margin: 10px 0;
      }
      .notes-section {
        margin-top: 15px;
        border-top: 1px solid #eee;
        padding-top: 10px;
      }

      .add-to-cart-container {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 10px;
        margin-top: 15px;
      }

      .qty-control {
        display: flex;
        align-items: center;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      .qty-control button {
        background: none;
        border: none;
        font-size: 1.2rem;
        padding: 5px 10px;
        cursor: pointer;
        height: 40px;
        width: 40px;
      }
      .qty-control span {
        padding: 5px 10px;
        font-weight: bold;
      }

      #add-to-cart-button {
        background-color: var(--accent-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: bold;
        transition: opacity 0.2s;
        height: 40px;
      }
      #add-to-cart-button:hover {
        opacity: 0.9;
      }
      #add-to-cart-button.in-cart {
        background-color: var(--tag-sale);
      }

      /* ================= 7. Ë¥≠Áâ©ËΩ¶Ê®°ÊÄÅÊ°Ü (Cart Modal) ================= */
      #cart-items-container {
        margin-top: 15px;
      }

      .cart-item {
        display: flex;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }

      .cart-item-img {
        width: 60px;
        height: 60px;
        object-fit: contain;
        margin-right: 15px;
        flex-shrink: 0;
      }

      .cart-item-details {
        flex-grow: 1;
      }

      .cart-item-name {
        font-weight: bold;
        font-size: 1rem;
      }

      .cart-item-price {
        font-size: 0.9rem;
        color: #999;
      }

      .cart-item-actions {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      #cart-summary {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 2px solid #ddd;
        font-size: 1.2rem;
        font-weight: bold;
        text-align: right;
      }

      #checkout-button {
        display: block;
        width: 100%;
        background-color: var(--tag-hot);
        color: white;
        border: none;
        padding: 12px;
        border-radius: 4px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
      }

      /* ================= 8. Toast ÊèêÁ§∫ ================= */
      #toast {
        visibility: hidden;
        min-width: 250px;
        background-color: #333;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 16px;
        position: fixed;
        z-index: 3000;
        left: 50%;
        bottom: 30px;
        transform: translateX(-50%);
        font-size: 1rem;
        opacity: 0;
        transition: opacity 0.5s;
      }

      #toast.show {
        visibility: visible;
        opacity: 1;
      }

      /* ================= 9. ÊâπÂèëÊäòÊâ£Ê®™ÂπÖ ================= */
      #wholesale-banner {
        background-color: var(--tag-new);
        color: white;
        text-align: center;
        padding: 8px 0;
        font-weight: bold;
        position: sticky;
        top: var(--header-height); /* ‰Ωç‰∫éÂ§¥ÈÉ®‰∏ãÊñπ */
        z-index: 900;
        display: none; /* ÈªòËÆ§ÈöêËóè */
      }
      #wholesale-banner.show {
        display: block;
      }

      /* ================= 10. ÂìçÂ∫îÂºèË∞ÉÊï¥ (Mobile Adjustments) ================= */
      @media (max-width: 768px) {
        #search-input {
          width: 100px;
        }
        #search-input:focus {
          width: 150px;
        }
        #sidebar {
          width: 80%; /* ÊâãÊú∫‰∏ä‰æßËæπÊ†èÊõ¥ÂÆΩ */
        }
        #modal-product-details {
          flex-direction: column;
        }
        #modal-product-img {
          width: 100%;
          height: auto;
          max-height: 250px;
        }
        .modal-content {
          margin: 10% 10px;
          max-width: none;
        }
        .add-to-cart-container {
          justify-content: space-between;
        }
      }
    </style>
  </head>
  <body>
    <header id="header">
      <button
        class="icon-button"
        onclick="toggleSidebar()"
        aria-label="Open Menu"
      >
        &#9776;
      </button>
      <a href="#" id="header-logo" onclick="renderHome()">Top Outlet</a>

      <div id="search-container">
        <input
          type="text"
          id="search-input"
          placeholder="Search Products..."
          onkeypress="handleSearch(event)"
        />
        <button id="search-button" onclick="performSearch()">Search</button>
      </div>

      <button class="icon-button" onclick="showCartModal()">
        &#128722;
        <span id="header-cart-count">0</span>
      </button>
    </header>

    <div id="wholesale-banner"></div>

    <nav id="sidebar"></nav>
    <div id="backdrop" onclick="toggleSidebar()"></div>

    <main id="main-content">
      <section id="home-view"></section>

      <section id="grid-view" style="display: none">
        <h1 id="grid-title"></h1>
        <div id="product-grid"></div>
        <div id="pagination-controls">
          <button id="prev-page" onclick="changePage(-1)">Previous</button>
          <span id="page-info">Page 1 of 1</span>
          <button id="next-page" onclick="changePage(1)">Next</button>
        </div>
      </section>
    </main>

    <div id="product-modal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal('product-modal')"
          >&times;</span
        >
        <div id="modal-product-details">
          <img id="modal-product-img" src="" alt="Product Image" />
          <div class="modal-text">
            <p id="modal-brand"></p>
            <h2 id="modal-name"></h2>
            <p>
              SKU: <span id="modal-sku"></span> | Size:
              <span id="modal-ml"></span>ml
            </p>
            <p class="price" id="modal-price"></p>

            <div class="notes-section">
              <h4>Notes</h4>
              <p id="modal-notes"></p>
              <p id="modal-gender" style="font-style: italic"></p>
            </div>
          </div>
        </div>

        <div class="add-to-cart-container">
          <div class="qty-control">
            <button
              id="qty-minus"
              onclick="updateCartQuantity(currentProductId, -1)"
            >
              -
            </button>
            <span id="modal-qty-in-cart">0</span>
            <button
              id="qty-plus"
              onclick="updateCartQuantity(currentProductId, 1)"
            >
              +
            </button>
          </div>
          <button id="add-to-cart-button" onclick="toggleCartState()">
            Add to Cart
          </button>
        </div>
      </div>
    </div>

    <div id="cart-modal" class="modal">
      <div class="modal-content">
        <span class="close-button" onclick="closeModal('cart-modal')"
          >&times;</span
        >
        <h2>Shopping Cart</h2>
        <div id="cart-items-container"></div>
        <div id="cart-summary"></div>
        <button
          id="checkout-button"
          onclick="alert('Proceeding to Checkout...')"
        >
          Proceed to Checkout
        </button>
      </div>
    </div>

    <div id="toast">Item added to cart!</div>

    <script>
      // ÂÅáËÆæËøôÊòØ‰ªé '‰∫ßÂìÅÁÆ°ÁêÜ - Â∑•‰ΩúË°®1.csv' Âä†ËΩΩÁöÑÊï∞ÊçÆÁªìÊûÑ
      // Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠Ôºå‰Ω†ÈúÄË¶Å‰∏Ä‰∏™ÂáΩÊï∞Êù•ËØªÂèñÂíåËß£Êûê CSV Êñá‰ª∂Âà∞Ëøô‰∏™ÁªìÊûÑ
      window.perfumeDB = [
        // A01 to A250, including stock and pricing data
        {
          top: "1",
          id: "A01",
          name: "Valentino Donna Born in Roma Intense",
          brand: "Valentino",
          img: "images/perfume1.webp",
          stock: "1",
          price: "36",
          sku: "ÂÜíÈô©Â∞èÂßê(Áæé‰∏≠)",
          ml: "100",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Bourbon Vanilla, Jasmine, Benzoin",
        },
        {
          top: "1",
          id: "A02",
          name: "Valentino Donna Born in Roma",
          brand: "Valentino",
          img: "images/perfume2.webp",
          stock: "1",
          price: "36",
          sku: "ÊúãÂÖãÁîúÂøÉ(Áæé‰∏≠)",
          ml: "100",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Black Currant, Pear, Bourbon Vanilla, Cashmeran",
        },
        {
          top: "1",
          id: "A03",
          name: "Valentino Uomo Born in Roma",
          brand: "Valentino",
          img: "images/perfume3.webp",
          stock: "1",
          price: "36",
          sku: "Êú∫ËΩ¶È™ëÂ£´(Áæé‰∏≠)",
          ml: "100",
          new: "",
          sale: "",
          gender: "Men",
          Notes: "Mineral notes, Violet Leaf, Salt, Ginger, Vetiver",
        },
        {
          top: "1",
          id: "A04",
          name: "Miss Dior Blooming Bouquet",
          brand: "Dior",
          img: "images/perfume4.webp",
          stock: "1",
          price: "35",
          sku: "ÁîúÂøÉÂ∞èÂßê",
          ml: "100",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Peony, Damascus Rose, Calabrian Bergamot, White Musk",
        },
        {
          top: "0",
          id: "A05",
          name: "Lanc√¥me La vie est belle",
          brand: "Lanc√¥me",
          img: "images/perfume5.webp",
          stock: "0",
          price: "38",
          sku: "ÂÖ∞ËîªÁæé‰∏Ω‰∫∫Áîü",
          ml: "75",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Black Currant, Pear, Iris, Praline, Vanilla, Patchouli",
        },
        {
          top: "1",
          id: "A06",
          name: "Chanel Coco Mademoiselle L'eau Privee",
          brand: "Chanel",
          img: "images/perfume6.webp",
          stock: "1",
          price: "36",
          sku: "COCO chanel",
          ml: "100",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Mendarin Orange, Rose, Jasmine, White Musk",
        },
        {
          top: "1",
          id: "A07",
          name: "Yves Saint Laurent Mon Paris Eau de Parfum",
          brand: "Yves Saint Laurent",
          img: "images/perfume7.webp",
          stock: "1",
          price: "37",
          sku: "ÂèçËΩ¨Â∑¥Èªé",
          ml: "90",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Strawberry, Raspberry, Pear, Datura, Patchouli",
        },
        {
          top: "1",
          id: "A08",
          name: "Louis Vuitton Imagination",
          brand: "Louis Vuitton",
          img: "images/perfume8.webp",
          stock: "1",
          price: "40",
          sku: "Á†¥Êôì",
          ml: "100",
          new: "",
          sale: "",
          gender: "Men",
          Notes: "Ambroxan, Black Tea, Neroli, Calabrian Bergamot",
        },
        {
          top: "1",
          id: "A09",
          name: "Gucci Bloom Eau de Parfum",
          brand: "Gucci",
          img: "images/perfume9.webp",
          stock: "1",
          price: "35",
          sku: "Ëä±ÊÇ¶Â•≥Â£´",
          ml: "100",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Tuberose, Jasmine Bud, Rangoon Creeper",
        },
        {
          top: "1",
          id: "A10",
          name: "Carolina Herrera Good Girl",
          brand: "Carolina Herrera",
          img: "images/perfume10.webp",
          stock: "1",
          price: "37",
          sku: "Â•ΩÂ•≥Â≠©(È´òË∑üÈûã)",
          ml: "80",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Almond, Coffee, Tuberose, Jasmine, Tonka Bean, Cocoa",
        },
        {
          top: "0",
          id: "A11",
          name: "Dior Sauvage Eau de Parfum",
          brand: "Dior",
          img: "images/perfume11.webp",
          stock: "1",
          price: "38",
          sku: "Êó∑ÈáéÁî∑Â£´",
          ml: "100",
          new: "",
          sale: "",
          gender: "Men",
          Notes: "Bergamot, Sichuan Pepper, Ambroxan",
        },
        {
          top: "1",
          id: "A12",
          name: "Tom Ford Lost Cherry",
          brand: "Tom Ford",
          img: "images/perfume12.webp",
          stock: "1",
          price: "39",
          sku: "Â§±ËêΩÊ®±Ê°É",
          ml: "50",
          new: "",
          sale: "",
          gender: "Unisex",
          Notes:
            "Black Cherry, Bitter Almond, Turkish Rose, Roasted Tonka Bean",
        },
        {
          top: "0",
          id: "A13",
          name: "Xerjoff Naxos",
          brand: "Xerjoff",
          img: "images/perfume13.webp",
          stock: "1",
          price: "40",
          sku: "Á∫≥ÂÖãÁ¥¢ÊñØ",
          ml: "100",
          new: "",
          sale: "",
          gender: "Unisex",
          Notes: "Honey, Tobacco, Vanilla, Lavender, Cinnamon, Cashmeran",
        },
        {
          top: "1",
          id: "A14",
          name: "Creed Aventus",
          brand: "Creed",
          img: "images/perfume14.webp",
          stock: "1",
          price: "41",
          sku: "Èì∂Ëâ≤Â±±Ê≥â",
          ml: "100",
          new: "",
          sale: "",
          gender: "Men",
          Notes:
            "Blackcurrant, Bergamot, Apple, Pineapple, Birch, Patchouli, Vanilla",
        },
        {
          top: "0",
          id: "A15",
          name: "Maison Francis Kurkdjian Baccarat Rouge 540",
          brand: "Maison Francis Kurkdjian",
          img: "images/perfume15.webp",
          stock: "1",
          price: "42",
          sku: "Á∫¢ÂÆùÁü≥",
          ml: "70",
          new: "",
          sale: "",
          gender: "Unisex",
          Notes: "Jasmine, Saffron, Cedarwood, Ambergris",
        },
        {
          top: "1",
          id: "A16",
          name: "Parfums de Marly Delina Exclusif",
          brand: "Parfums de Marly",
          img: "images/perfume16.webp",
          stock: "1",
          price: "40",
          sku: "Âæ∑ÈáåÂ®ú",
          ml: "75",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Turkish Rose, Lychee, Incense, Vanilla, Oud",
        },
        {
          top: "0",
          id: "A17",
          name: "Jean Paul Gaultier Le Male",
          brand: "Jean Paul Gaultier",
          img: "images/perfume17.webp",
          stock: "1",
          price: "35",
          sku: "Ë£∏Áî∑",
          ml: "125",
          new: "",
          sale: "",
          gender: "Men",
          Notes: "Mint, Lavender, Vanilla, Tonka Bean, Sandalwood",
        },
        {
          top: "1",
          id: "A18",
          name: "Bond No. 9 New York Nights",
          brand: "Bond No. 9",
          img: "images/perfume18.webp",
          stock: "1",
          price: "40",
          sku: "Á∫ΩÁ∫¶‰πãÂ§ú",
          ml: "100",
          new: "",
          sale: "",
          gender: "Unisex",
          Notes: "Gardenia, Carnation, Patchouli, Sandalwood, Coffee, Caramel",
        },
        {
          top: "0",
          id: "A19",
          name: "Initio Oud for Greatness",
          brand: "Initio",
          img: "images/perfume19.webp",
          stock: "1",
          price: "41",
          sku: "Ê≤âÈ¶ôÁöÑ‰ºüÂ§ß",
          ml: "90",
          new: "",
          sale: "",
          gender: "Unisex",
          Notes: "Oud, Lavender, Saffron, Nutmeg, Patchouli, Musk",
        },
        {
          top: "1",
          id: "A20",
          name: "Paco Rabanne 1 Million",
          brand: "Paco Rabanne",
          img: "images/perfume20.webp",
          stock: "1",
          price: "35",
          sku: "Áôæ‰∏áÁî∑Â£´",
          ml: "100",
          new: "",
          sale: "",
          gender: "Men",
          Notes: "Grapefruit, Mint, Blood Orange, Rose, Cinnamon, Leather",
        },
        // ... (ÁúÅÁï•‰∫ÜA21Âà∞A249ÁöÑÂ§ßÈáèÊï∞ÊçÆÔºå‰ª•‰øùÊåÅ‰ª£Á†ÅÁÆÄÊ¥ÅÔºå‰ΩÜËØ∑Á°Æ‰øùÂú®ÊÇ®ÁöÑÂÆûÈôÖÊñá‰ª∂‰∏≠ÂåÖÂê´ÊâÄÊúâÊï∞ÊçÆ)
        {
          top: "0",
          id: "A246",
          name: "Lattafa Asad",
          brand: "Lattafa",
          img: "images/perfume246.webp",
          stock: "1",
          price: "38",
          sku: "ÈòøËê®Âæ∑",
          ml: "100",
          new: "",
          sale: "",
          gender: "Men",
          Notes:
            "Black Pepper, Pineapple, Tobacco, Vanilla, Amber, Woody Notes",
        },
        {
          top: "0",
          id: "A247",
          name: "Lattafa Khamrah",
          brand: "Lattafa",
          img: "images/perfume247.webp",
          stock: "1",
          price: "39",
          sku: "Âç°ÂßÜÊãâ",
          ml: "100",
          new: "",
          sale: "",
          gender: "Unisex",
          Notes: "Cinnamon, Nutmeg, Cognac, Tonka Bean, Vanilla, Benzoin",
        },
        {
          top: "0",
          id: "A248",
          name: "Lattafa Nebras",
          brand: "Lattafa",
          img: "images/perfume248.webp",
          stock: "1",
          price: "37",
          sku: "ÂÜÖÂ∏ÉÊãâÊñØ",
          ml: "100",
          new: "",
          sale: "",
          gender: "Unisex",
          Notes: "Red Berries, Mandarin Orange, Vanilla, Cacao, Amber",
        },
        {
          top: "0",
          id: "A249",
          name: "Kayali Vanilla | 28",
          brand: "Kayali",
          img: "images/perfume249.webp",
          stock: "1",
          price: "40",
          sku: "È¶ôËçâ28",
          ml: "100",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Vanilla, Orchid, Tonka Bean, Amber, Musk, Brown Sugar",
        },
        {
          top: "0",
          id: "A250",
          name: "Kayali Deja Vu White Flower | 57",
          brand: "Kayali",
          img: "images/perfume250.webp",
          stock: "1",
          price: "38",
          sku: "ÁôΩËä±",
          ml: "100",
          new: "",
          sale: "",
          gender: "Women",
          Notes: "Gardenia, Tuberose, Jasmine, Patchouli, Sandalwood",
        },
      ];

      // ÂÖ®Â±ÄÁä∂ÊÄÅ
      let cartItems = [];
      let currentProductId = null;
      let viewMode = "home"; // "home" or "grid"
      const ITEMS_PER_PAGE = 20;
      let currentPage = 1;
      let currentGridData = [];

      // ================= 1. Âü∫Á°ÄÂ∑•ÂÖ∑ÂáΩÊï∞ =================

      function getProductById(id) {
        return window.perfumeDB.find((p) => p.id === id);
      }

      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        sidebar.classList.toggle("open");
        document.body.classList.toggle("no-scroll"); // ÂÅáËÆæ‰Ω†Âú®CSS‰∏≠ÂÆö‰πâ‰∫Ü no-scroll Êù•Èò≤Ê≠¢ËÉåÊôØÊªöÂä®
      }

      function closeModal(id) {
        document.getElementById(id).classList.remove("show");
        if (id === "product-modal") currentProductId = null;
      }

      // ================= 2. ÊêúÁ¥¢ÈÄªËæë (Â∑≤‰ºòÂåñ) =================

      function handleSearch(event) {
        if (event.key === "Enter") {
          performSearch();
        }
      }

      function performSearch() {
        const input = document.getElementById("search-input");
        const term = input.value.trim();
        if (term) {
          switchToGrid(`Search:${term}`);
        }
      }

      // ================= ÂìÅÁâåÂ∏∏ÈáèÂÆö‰πâ (Áî®‰∫é Home ËßÜÂõæÂíå "Other" Á≠õÈÄâ) =================
      const FEATURED_BRANDS = [
        "Creed",
        "Dior",
        "Chanel",
        "Tom Ford",
        "Yves Saint Laurent",
        "Louis Vuitton",
        "Gucci",
        "Carolina Herrera",
        "Valentino",
        "Maison Francis Kurkdjian",
        "Parfums de Marly",
        "Jean Paul Gaultier",
        "Xerjoff",
        "Bond No. 9",
        "Initio",
        "Paco Rabanne",
        "Giorgio Armani",
        "Burberry",
        "Versace",
      ];
      const FEATURED_BRANDS_LOWER = FEATURED_BRANDS.map((b) => b.toLowerCase());

      // ================= Êñ∞Â¢ûÊàñ‰øÆÊîπËæÖÂä©ÂáΩÊï∞ÔºöÊêúÁ¥¢ËØçÊ†áÂáÜÂåñÂíåÊâ©Â±ï =================

      /**
       * Ê†áÂáÜÂåñÂíåÊâ©Â±ïÊêúÁ¥¢ËØçÔºöÂ§ÑÁêÜÁº©ÂÜôÂíåÂ∏∏ËßÅÁöÑÈîôÂà´Â≠ó„ÄÇ
       * @param {string} term ÂéüÂßãÊêúÁ¥¢ËØç
       * @returns {string[]} ÂåÖÂê´ÂéüÂßãËØç„ÄÅÊ†áÂáÜÂåñËØçÂíåÊâ©Â±ïËØçÁöÑÊï∞ÁªÑ
       */
      function normalizeSearchTerm(term) {
        if (!term) return [];
        const normalized = term.toLowerCase().trim();
        const terms = [normalized];

        // Â∏∏Áî®ÂìÅÁâåÁº©ÂÜôÊò†Â∞ÑÂíåÂ∏∏ËßÅÈîôÂà´Â≠ó‰øÆÊ≠£
        // key: Áº©ÂÜôÊàñÈîôÂà´Â≠ó, value: Ê≠£Á°ÆÊàñÂÆåÊï¥ÁöÑÂêçÁß∞
        const abbreviations = {
          lv: "louis vuitton",
          ysl: "yves saint laurent",
          mkf: "maison francis kurkdjian",
          mfk: "maison francis kurkdjian",
          pdm: "parfums de marly",
          tf: "tom ford",
          "giorgio armeni": "giorgio armani", // ‰øÆÊ≠£csv‰∏≠ÁöÑÈîôÂà´Â≠ó
          armani: "giorgio armani", // ÂÖÅËÆ∏ÊêúÁ¥¢ armani ÂåπÈÖçÂà∞ÂÖ®Áß∞
          chanel: "chanel no", // Â∏ÆÂä©ÊêúÁ¥¢ Chanel N¬∞5 Á≠â
        };

        // 1. Ê∑ªÂä†Áº©ÂÜôÂ±ïÂºÄÂêéÁöÑÂÖ®Áß∞
        if (abbreviations[normalized]) {
          terms.push(abbreviations[normalized]);
        }

        // 2. Ê£ÄÊü•ÂìÅÁâåÂÖ®Áß∞ÊòØÂê¶ÂåÖÂê´ÊêúÁ¥¢ËØçÔºåÂ¶ÇÊûúÊòØÔºåÂàô‰πüÂä†ÂÖ•ÂÖ®Áß∞ËøõË°åÂåπÈÖç
        for (const [abbr, full] of Object.entries(abbreviations)) {
          // Â¶ÇÊûúÂéüÂßãÊêúÁ¥¢ËØçÊòØÂÖ®Áß∞ÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÂàô‰πüÂä†ÂÖ•ÂÖ®Áß∞ËøõË°åÂåπÈÖç
          if (full.includes(normalized) && !terms.includes(full)) {
            terms.push(full);
          }
        }

        // 3. ÈîôÂà´Â≠ó‰øÆÊ≠£ÔºàÂ¶ÇÊûúÊêúÁ¥¢ËØçÊòØÂ∏∏ËßÅÈîôËØØÔºåÊ∑ªÂä†Ê≠£Á°ÆÁöÑËØçÔºâ
        if (
          abbreviations[normalized] &&
          abbreviations[normalized] !== normalized
        ) {
          terms.push(abbreviations[normalized]);
        }

        return Array.from(new Set(terms.filter((t) => t.length > 0))); // ÂéªÈáçÂπ∂ËøáÊª§Á©∫Â≠óÁ¨¶‰∏≤
      }

      // ================= 3. ËßÜÂõæÂàáÊç¢ÂíåÊ∏≤Êüì =================

      // --- 3.1 È¶ñÈ°µÊ∏≤Êüì ---
      function renderHome() {
        viewMode = "home";
        document.getElementById("home-view").style.display = "block";
        document.getElementById("grid-view").style.display = "none";
        window.scrollTo({ top: 0, behavior: "smooth" });

        const homeView = document.getElementById("home-view");
        homeView.innerHTML = "";

        // a. Á≠õÈÄâÊúâÂ∫ìÂ≠òÁöÑ‰∫ßÂìÅ
        const db = (window.perfumeDB || []).filter(
          (p) => parseInt(p.stock) !== 0
        );

        // b. Ê∏≤ÊüìÁâπËâ≤ÂàÜÁ±ª (Best Sellers, New Arrivals, Sale)
        const categories = [
          { name: "Best Sellers", criteria: "BestSellers" },
          { name: "New Arrivals", criteria: "New" },
          { name: "Sale Products", criteria: "Sale" },
          { name: "All Products", criteria: "All" },
        ];

        const categoryHTML = `<div class="section-title">Shop by Category</div>
            <div class="brand-grid">
                ${categories
                  .map(
                    (c) =>
                      `<div class="brand-card" onclick="switchToGrid('${c.criteria}')">
                        <div class="brand-name">${c.name}</div>
                    </div>`
                  )
                  .join("")}
            </div>`;
        homeView.innerHTML += categoryHTML;

        // c. Ê∏≤ÊüìÁâπËâ≤ÂìÅÁâå (FEATURED_BRANDS)
        const featuredBrandsHTML = `<div class="section-title">Featured Brands</div>
            <div class="brand-grid">
                ${FEATURED_BRANDS.map(
                  (brand) =>
                    `<div class="brand-card" onclick="switchToGrid('${brand}')">
                        <div class="brand-name">${brand}</div>
                    </div>`
                ).join("")}
                <div class="brand-card" onclick="switchToGrid('Other')">
                    <div class="brand-name">Other Brands</div>
                </div>
            </div>`;
        homeView.innerHTML += featuredBrandsHTML;
      }

      // --- 3.2 Grid Ê∏≤Êüì (Â∑≤Êõ¥Êñ∞ÊÄßÂà´Á≠õÈÄâ, Â¢ûÂº∫ÊêúÁ¥¢) ---
      function switchToGrid(criteria) {
        viewMode = "grid";
        document.getElementById("home-view").style.display = "none";
        document.getElementById("grid-view").style.display = "block";
        window.scrollTo({ top: 0, behavior: "smooth" });

        const db = (window.perfumeDB || []).filter(
          (p) => parseInt(p.stock) !== 0
        );
        let filtered = [];
        let title = "";

        // --- 3.2.1 Á≠õÈÄâÈÄªËæë ---
        if (criteria === "All") {
          filtered = db;
          title = "All Products";
        } else if (criteria === "BestSellers") {
          filtered = db.filter((p) => p.top === "1");
          title = "Best Sellers";
        } else if (criteria === "New") {
          filtered = db.filter((p) => p.new === "1");
          title = "New Arrivals";
        } else if (criteria === "Sale") {
          filtered = db.filter((p) => p.sale === "1");
          title = "Sale Products";
        } else if (criteria.startsWith("Gender:")) {
          const gender = criteria.replace("Gender:", "").trim();
          filtered = db.filter(
            (p) => p.gender && p.gender.toLowerCase() === gender.toLowerCase()
          );
          title = gender;
        } else if (criteria.startsWith("Search:")) {
          // ** ÊêúÁ¥¢‰ºòÂåñÊ†∏ÂøÉÈÄªËæë **
          const rawTerm = criteria.replace("Search:", "").trim();
          const searchTerms = normalizeSearchTerm(rawTerm);

          filtered = db.filter((p) => {
            const pName = p.name ? p.name.toLowerCase() : "";
            const pBrand = p.brand ? p.brand.toLowerCase() : "";
            const pId = p.id ? p.id.toString().toLowerCase() : "";

            // Ê£ÄÊü•‰∫ßÂìÅ‰ø°ÊÅØÊòØÂê¶ÂåÖÂê´‰ªª‰Ωï‰∏Ä‰∏™Ê†áÂáÜÂåñÂêéÁöÑÊêúÁ¥¢ËØç (Ê®°Á≥äÊêúÁ¥¢)
            return searchTerms.some((term) => {
              // 1. ID Ê®°Á≥äÂåπÈÖç
              if (pId.includes(term)) return true;

              // 2. ÂìÅÁâåÂêçÁß∞Ê®°Á≥äÂåπÈÖç (Â¶ÇÊêú lv ÂåπÈÖçÂà∞ louis vuitton)
              if (pBrand.includes(term)) return true;

              // 3. ‰∫ßÂìÅÂêçÁß∞Ê®°Á≥äÂåπÈÖç
              if (pName.includes(term)) return true;

              return false;
            });
          });

          title = `Results: "${rawTerm}" (${filtered.length} found)`;
        } else if (criteria === "Other") {
          filtered = db.filter((p) => {
            const pBrandLower = p.brand ? p.brand.toLowerCase() : "";
            return pBrandLower && !FEATURED_BRANDS_LOWER.includes(pBrandLower);
          });
          title = "Other Brands";
        } else {
          // ** ÂìÅÁâåÁÇπÂáªÈÄªËæë‰ºòÂåñ **
          // ÂìÅÁâåÁÇπÂáªÁ≠õÈÄâ‰πü‰ΩøÁî®Ê†áÂáÜÂåñÔºå‰ª•Â∫îÂØπÊï∞ÊçÆÊ∫ê‰∏≠ÁöÑ‰∏çËßÑËåÉÂêçÁß∞ÊàñÂà´Âêç
          const normalizedCriteria = normalizeSearchTerm(criteria);

          filtered = db.filter((p) => {
            const pBrand = p.brand ? p.brand.toLowerCase() : "";
            // Âè™Ë¶ÅÂìÅÁâåÂåÖÂê´‰ªª‰Ωï‰∏Ä‰∏™Ê†áÂáÜÂåñÂêéÁöÑËØçÂ∞±ÂåπÈÖç (Â¶ÇÁÇπÂáª Armani, ÂåπÈÖçÂà∞ Giorgio Armani)
            return normalizedCriteria.some((term) => pBrand.includes(term));
          });
          title = criteria;
        }

        document.getElementById("grid-title").textContent = title;
        currentGridData = filtered;
        currentPage = 1;
        renderGridPage();
      }

      // --- 3.3 Grid È°µÈù¢Ê∏≤Êüì ---
      function renderGridPage() {
        const grid = document.getElementById("product-grid");
        grid.innerHTML = "";

        const start = (currentPage - 1) * ITEMS_PER_PAGE;
        const end = start + ITEMS_PER_PAGE;
        const pageData = currentGridData.slice(start, end);
        const totalPages = Math.ceil(currentGridData.length / ITEMS_PER_PAGE);

        pageData.forEach((p) => {
          let tags = "";
          if (p.top === "1") tags += `<span class="tag tag-hot">HOT</span>`;
          if (p.new === "1") tags += `<span class="tag tag-new">NEW</span>`;
          if (p.sale === "1") tags += `<span class="tag tag-sale">SALE</span>`;

          const card = document.createElement("div");
          card.className = "product-card";
          card.setAttribute("data-id", p.id);
          card.onclick = () => showProductModal(p.id);
          card.innerHTML = `
                <div class="product-tags">${tags}</div>
                <img src="${p.img}" alt="${p.name}" class="product-img" />
                <div class="product-brand">${p.brand}</div>
                <div class="product-name">${p.name}</div>
                <div class="product-price">$${p.price}</div>
            `;
          grid.appendChild(card);
        });

        // Êõ¥Êñ∞ÂàÜÈ°µÊéßÂà∂
        document.getElementById(
          "page-info"
        ).textContent = `Page ${currentPage} of ${totalPages}`;
        document.getElementById("prev-page").disabled = currentPage === 1;
        document.getElementById("next-page").disabled =
          currentPage >= totalPages;
      }

      function changePage(delta) {
        const totalPages = Math.ceil(currentGridData.length / ITEMS_PER_PAGE);
        const newPage = currentPage + delta;
        if (newPage >= 1 && newPage <= totalPages) {
          currentPage = newPage;
          renderGridPage();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      // ================= 4. ‰∫ßÂìÅËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü =================

      function showProductModal(id) {
        const p = getProductById(id);
        if (!p) return;

        currentProductId = id;

        document.getElementById("modal-product-img").src = p.img;
        document.getElementById("modal-brand").textContent = p.brand;
        document.getElementById("modal-name").textContent = p.name;
        document.getElementById("modal-sku").textContent = p.sku;
        document.getElementById("modal-ml").textContent = p.ml;
        document.getElementById("modal-price").textContent = `$${p.price}`;
        document.getElementById("modal-notes").textContent = p.Notes || "N/A";
        document.getElementById("modal-gender").textContent = p.gender
          ? `Gender: ${p.gender}`
          : "";

        // Êõ¥Êñ∞Ë¥≠Áâ©ËΩ¶Áä∂ÊÄÅ
        updateModalButtonState(id);

        document.getElementById("product-modal").classList.add("show");
      }

      function updateModalButtonState(id) {
        const item = cartItems.find((c) => c.name === id);
        const button = document.getElementById("add-to-cart-button");
        const qtySpan = document.getElementById("modal-qty-in-cart");

        if (item) {
          button.textContent = "Remove from Cart";
          button.classList.add("in-cart");
          qtySpan.textContent = item.quantity;
        } else {
          button.textContent = "Add to Cart";
          button.classList.remove("in-cart");
          qtySpan.textContent = 0;
        }

        // Á°Æ‰øùÊï∞ÈáèÊéßÂà∂ÊåâÈíÆÁöÑÂêØÁî®Áä∂ÊÄÅ
        const qtyInCart = item ? item.quantity : 0;
        document.getElementById("qty-minus").disabled = qtyInCart <= 0;
        document.getElementById("qty-plus").disabled = qtyInCart >= 99; // ÂÅáËÆæÊúÄÂ§ßÊï∞ÈáèÈôêÂà∂
      }

      function toggleCartState() {
        const id = currentProductId;
        if (!id) return;

        const item = cartItems.find((c) => c.name === id);

        if (item) {
          // Â¶ÇÊûúÂ∑≤Âú®Ë¥≠Áâ©ËΩ¶‰∏≠ÔºåÂàôÁßªÈô§
          cartItems = cartItems.filter((c) => c.name !== id);
          showToast("Item removed from cart!");
        } else {
          // Â¶ÇÊûú‰∏çÂú®Ë¥≠Áâ©ËΩ¶‰∏≠ÔºåÂàôÊ∑ªÂä† 1 ‰∏™
          const p = getProductById(id);
          if (!p) return;
          cartItems.push({
            name: id,
            price: parseFloat(p.price),
            quantity: 1,
            product: p,
          });
          showToast("Item added to cart!");
        }

        saveCart();
        updateModalButtonState(id);
      }

      function updateCartQuantity(id, delta) {
        if (!id) return;
        const existing = cartItems.find((c) => c.name === id);
        if (existing) {
          existing.quantity += delta;
          if (existing.quantity <= 0)
            cartItems = cartItems.filter((c) => c.name !== id);
          saveCart();

          // ÂÖ≥ÈîÆÔºö‰øÆÊîπÊï∞ÈáèÂêéÁ´ãÂç≥Êõ¥Êñ∞ÊäòÊâ£Ê®™ÂπÖ
          updateWholesaleBanner();

          updateModalButtonState(id);
          renderCartItems(); // Á°Æ‰øùË¥≠Áâ©ËΩ¶Ê®°ÊÄÅÊ°Ü‰∏≠ÁöÑÊï∞ÈáèÂêåÊ≠•
        }
      }

      function showToast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 2000);
      }

      // ================= 5. Ë¥≠Áâ©ËΩ¶ÂíåÊåÅ‰πÖÂåñ =================

      function loadCart() {
        cartItems = JSON.parse(localStorage.getItem("perfumeCart") || "[]");
        updateCartCount();

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñÊ®™ÂπÖÁä∂ÊÄÅ
        updateWholesaleBanner();
      }

      function saveCart() {
        localStorage.setItem("perfumeCart", JSON.stringify(cartItems));
        updateCartCount();
        renderCartItems(); // Á°Æ‰øùÊØèÊ¨°‰øùÂ≠òÈÉΩÈáçÊñ∞Ê∏≤ÊüìË¥≠Áâ©ËΩ¶ÂÜÖÂÆπ
      }

      function updateCartCount() {
        const el = document.getElementById("header-cart-count");
        if (el) el.textContent = cartItems.reduce((s, i) => s + i.quantity, 0);
      }

      function setupModalBackdropClosing() {
        document.querySelectorAll(".modal").forEach((o) =>
          o.addEventListener("click", (e) => {
            if (e.target.classList.contains("modal")) {
              e.target.classList.remove("show");
            }
          })
        );
      }

      function showCartModal() {
        renderCartItems();
        document.getElementById("cart-modal").classList.add("show");
      }

      function renderCartItems() {
        const container = document.getElementById("cart-items-container");
        const summary = document.getElementById("cart-summary");
        container.innerHTML = "";
        let subtotal = 0;
        let totalQuantity = 0;

        if (cartItems.length === 0) {
          container.innerHTML = "<p>Your cart is empty.</p>";
          summary.textContent = "Subtotal: $0.00";
          document.getElementById("checkout-button").disabled = true;
          return;
        }

        document.getElementById("checkout-button").disabled = false;

        cartItems.forEach((item) => {
          const p = item.product || getProductById(item.name);
          const itemTotal = item.price * item.quantity;
          subtotal += itemTotal;
          totalQuantity += item.quantity;

          const itemEl = document.createElement("div");
          itemEl.className = "cart-item";
          itemEl.innerHTML = `
                <img src="${p.img}" alt="${p.name}" class="cart-item-img" />
                <div class="cart-item-details">
                    <div class="cart-item-name">${p.name}</div>
                    <div class="cart-item-price">$${item.price.toFixed(2)} x ${
            item.quantity
          } = $${itemTotal.toFixed(2)}</div>
                </div>
                <div class="cart-item-actions">
                    <div class="qty-control">
                        <button onclick="updateCartQuantity('${
                          item.name
                        }', -1)" ${
            item.quantity <= 1 ? "disabled" : ""
          }>-</button>
                        <span>${item.quantity}</span>
                        <button onclick="updateCartQuantity('${
                          item.name
                        }', 1)" ${
            item.quantity >= 99 ? "disabled" : ""
          }>+</button>
                    </div>
                </div>
            `;
          container.appendChild(itemEl);
        });

        // ËÆ°ÁÆóÊäòÊâ£
        const discountRate = totalQuantity >= 5 ? 0.1 : 0; // 5‰ª∂Êàñ‰ª•‰∏ä‰∫´Âèó10%ÊäòÊâ£
        const discountAmount = subtotal * discountRate;
        const finalTotal = subtotal - discountAmount;

        let summaryHTML = `Subtotal: $${subtotal.toFixed(2)}`;
        if (discountAmount > 0) {
          summaryHTML += `<br>Wholesale Discount (${(
            discountRate * 100
          ).toFixed(0)}%): -$${discountAmount.toFixed(2)}`;
          summaryHTML += `<br>Final Total: $${finalTotal.toFixed(2)}`;
        } else {
          summaryHTML += `<br>Final Total: $${finalTotal.toFixed(2)}`;
        }

        summary.innerHTML = summaryHTML;
      }

      // ================= 6. ÊâπÂèëÊäòÊâ£Ê®™ÂπÖÈÄªËæë =================

      function updateWholesaleBanner() {
        const totalQuantity = cartItems.reduce((s, i) => s + i.quantity, 0);
        const banner = document.getElementById("wholesale-banner");

        if (totalQuantity >= 5) {
          banner.textContent =
            "üéâ Congratulations! You received a 10% wholesale discount!";
          banner.classList.add("show");
        } else {
          const needed = 5 - totalQuantity;
          if (needed > 0) {
            banner.textContent = `Buy ${needed} more item(s) to get a 10% wholesale discount!`;
            banner.classList.add("show");
          } else {
            banner.classList.remove("show");
          }
        }
      }

      // ================= 7. ÂàùÂßãÂåñ =================
      document.addEventListener("DOMContentLoaded", () => {
        loadCart();
        setupModalBackdropClosing();
        renderHome(); // ÈªòËÆ§Âä†ËΩΩÈ¶ñÈ°µ

        // Á°Æ‰øù #sidebar ÂåÖÂê´ÊâÄÊúâÁ≠õÈÄâÈÄâÈ°π
        setupSidebarMenu();
      });

      function setupSidebarMenu() {
        const sidebar = document.getElementById("sidebar");
        sidebar.innerHTML = ""; // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ

        // ‰∏ªÂàÜÁ±ª
        const mainCategories = [
          { label: "Home", criteria: "All", isHome: true },
          {
            label: "Best Sellers (Hot)",
            criteria: "BestSellers",
            isHighlight: true,
          },
          { label: "New Arrivals", criteria: "New" },
          { label: "Sale", criteria: "Sale", isHighlight: true },
        ];

        mainCategories.forEach((cat) => {
          const item = document.createElement("a");
          item.className = "menu-item";
          item.textContent = cat.label;
          if (cat.isHighlight) item.classList.add("highlight");
          item.onclick = (e) => {
            e.preventDefault();
            switchToGrid(cat.criteria);
            toggleSidebar();
          };
          sidebar.appendChild(item);
        });

        // ÊÄßÂà´Á≠õÈÄâ
        const genderCategories = ["Women", "Men", "Unisex"];

        const genderTitle = document.createElement("h4");
        genderTitle.textContent = "Shop by Gender";
        genderTitle.style.padding = "10px 20px 5px";
        genderTitle.style.margin = "0";
        genderTitle.style.borderBottom = "1px solid #eee";
        sidebar.appendChild(genderTitle);

        genderCategories.forEach((gender) => {
          const item = document.createElement("a");
          item.className = "menu-item";
          item.textContent = gender;
          item.onclick = (e) => {
            e.preventDefault();
            switchToGrid(`Gender:${gender}`);
            toggleSidebar();
          };
          sidebar.appendChild(item);
        });

        // ÂìÅÁâåÂàóË°®
        const brandTitle = document.createElement("h4");
        brandTitle.textContent = "Shop by Brand";
        brandTitle.style.padding = "10px 20px 5px";
        brandTitle.style.margin = "0";
        brandTitle.style.borderBottom = "1px solid #eee";
        sidebar.appendChild(brandTitle);

        // Ëé∑ÂèñÊâÄÊúâÊúâÂ∫ìÂ≠òÁöÑÂîØ‰∏ÄÂìÅÁâå
        const db = (window.perfumeDB || []).filter(
          (p) => parseInt(p.stock) !== 0
        );
        const allBrands = Array.from(new Set(db.map((p) => p.brand))).sort();

        allBrands.forEach((brand) => {
          const item = document.createElement("a");
          item.className = "menu-item";
          item.textContent = brand;
          item.onclick = (e) => {
            e.preventDefault();
            // ÂìÅÁâåÁÇπÂáªÁõ¥Êé•‰ΩøÁî®ÂìÅÁâåÂêçÁß∞‰Ωú‰∏∫ criteria
            switchToGrid(brand);
            toggleSidebar();
          };
          sidebar.appendChild(item);
        });
      }
    </script>
  </body>
</html>
