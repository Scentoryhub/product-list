<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <title>Top Outlet Perfume</title>
    <link rel="icon" type="image/png" href="icon/32.png" />
    <link rel="apple-touch-icon" href="icon/180.png" />

    <style>
      /* ================= 1. ÂÖ®Â±Ä‰∏éÂèòÈáè ================= */
      :root {
        --header-height: 60px;
        --sidebar-width: 300px;
        --accent-color: #b28900;
        --bg-color: #f8f8f8;
        --font-main: "Helvetica Neue", Helvetica, Arial, sans-serif;
        --skeleton-base: #e0e0e0;
        --skeleton-highlight: #f5f5f5;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        margin: 0;
        padding: 0;
        padding-top: var(--header-height);
        padding-bottom: 80px;
        font-family: var(--font-main);
        background: var(--bg-color);
        color: #333;
        -webkit-font-smoothing: antialiased;
        overflow-x: hidden;
      }
      a {
        text-decoration: none;
        color: inherit;
        cursor: pointer;
      }
      button {
        outline: none;
        font-family: inherit;
        border: none;
        background: none;
        padding: 0;
        cursor: pointer;
      }

      /* ================= 2. È™®Êû∂Â±èÂä®Áîª (Skeleton) ================= */
      @keyframes shimmer {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }
      .skeleton {
        background: linear-gradient(
          90deg,
          var(--skeleton-base) 25%,
          var(--skeleton-highlight) 50%,
          var(--skeleton-base) 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 4px;
      }
      /* ÂõæÁâáÂÆπÂô®ÔºåÁî®‰∫éÂç†‰Ωç */
      .img-wrapper {
        width: 100%;
        height: 150px;
        background: #f9f9f9;
        border-radius: 4px;
        margin-bottom: 8px;
        position: relative;
        overflow: hidden;
      }
      .img-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0;
        transition: opacity 0.3s;
      }
      .img-wrapper img.loaded {
        opacity: 1;
      }

      /* ================= 3. Â§¥ÈÉ®‰∏éÊêúÁ¥¢Â¢ûÂº∫ ================= */
      .site-header {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: var(--header-height);
        background-color: #000;
        color: #fff;
        display: flex;
        align-items: center;
        padding: 0 10px;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        gap: 10px;
      }
      .header-left {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 5px;
      }
      .hamburger-icon {
        font-size: 1.6rem;
      }
      .menu-text {
        display: none;
        font-size: 0.8rem;
        font-weight: 700;
        letter-spacing: 1px;
      }
      @media (min-width: 360px) {
        .menu-text {
          display: inline;
        }
      }

      /* ÊêúÁ¥¢ÂÆπÂô® */
      .header-center {
        flex-grow: 1;
        position: relative;
      }
      .header-search-input {
        width: 100%;
        background: #333;
        border: 1px solid #444;
        color: #fff;
        padding: 10px 12px;
        border-radius: 4px;
        font-size: 1rem;
        outline: none;
        transition: all 0.2s;
      }
      .header-search-input:focus {
        background: #fff;
        color: #000;
        border-color: #fff;
      }

      /* ÂÆûÊó∂ÊêúÁ¥¢Âª∫ËÆÆ‰∏ãÊãâÊ°Ü */
      .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        background: #fff;
        color: #000;
        border-radius: 0 0 4px 4px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        max-height: 300px;
        overflow-y: auto;
        display: none;
      }
      .suggestion-item {
        padding: 12px;
        border-bottom: 1px solid #eee;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
      }
      .suggestion-item:active {
        background: #f0f0f0;
      }
      .suggestion-thumb {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 4px;
        background: #eee;
      }
      .suggestion-text {
        font-size: 0.9rem;
        flex: 1;
      }

      .header-right {
        position: relative;
        cursor: pointer;
        padding: 5px;
        margin-right: 5px;
      }
      .header-cart-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #d9534f;
        color: white;
        font-size: 0.7rem;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border: 2px solid #000;
      }

      /* ================= 4. ‰æßËæπÊ†è ================= */
      .sidebar-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1001;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s;
      }
      .sidebar-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        width: 85%;
        max-width: var(--sidebar-width);
        background: #fff;
        z-index: 1002;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        display: flex;
        flex-direction: column;
      }
      .sidebar.active {
        transform: translateX(0);
      }
      .sidebar-content {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
      }
      .menu-link {
        display: block;
        padding: 15px 0;
        font-weight: 600;
        border-bottom: 1px solid #eee;
        font-size: 1.1rem;
      }
      .brand-item {
        padding: 12px 5px;
        font-size: 1rem;
        border-bottom: 1px solid #f0f0f0;
      }

      /* ================= 5. È¶ñÈ°µÂç°Áâá‰∏éÊªöÂä®‰ºòÂåñ ================= */
      .brand-section {
        background: #fff;
        padding: 20px 0 20px 12px;
        margin-bottom: 15px;
        border-top: 1px solid #eee;
        position: relative;
      }
      .brand-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-right: 15px;
        margin-bottom: 15px;
      }
      .brand-title {
        font-size: 1.2rem;
        font-weight: 700;
        margin: 0;
        text-transform: uppercase;
      }

      /* ÊªöÂä®ÂÆπÂô®ÂåÖË£ÖÂô®ÔºåÁî®‰∫éÊîæÁΩÆÁÆ≠Â§¥ */
      .scroll-container-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .scroll-wrapper {
        display: flex;
        overflow-x: auto;
        gap: 12px;
        padding-bottom: 15px;
        padding-right: 12px;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
        flex: 1;
      }
      .scroll-wrapper::-webkit-scrollbar {
        display: none;
      }

      /* Ê°åÈù¢Á´ØÊªöÂä®ÁÆ≠Â§¥ */
      .scroll-nav-btn {
        display: none;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid #ddd;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 5;
        cursor: pointer;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        position: absolute;
        top: 35%;
        transition: all 0.2s;
      }
      .scroll-nav-btn:hover {
        background: #000;
        color: #fff;
        border-color: #000;
      }
      .scroll-nav-btn.left {
        left: 5px;
      }
      .scroll-nav-btn.right {
        right: 5px;
      }
      @media (min-width: 768px) {
        .scroll-nav-btn {
          display: flex;
        }
      }

      .scroll-card {
        flex: 0 0 160px;
        display: flex;
        flex-direction: column;
        background: #fff;
        cursor: pointer;
        position: relative;
        scroll-snap-align: start;
        user-select: none;
      }
      /* ÈïøÊåâÊó∂ÁöÑËßÜËßâÂèçÈ¶à */
      .scroll-card:active {
        transform: scale(0.98);
      }

      .badges-container {
        position: absolute;
        top: 0;
        left: 0;
        z-index: 2;
        display: flex;
        flex-direction: column;
      }
      .badge-tag {
        font-size: 0.65rem;
        color: #fff;
        padding: 4px 8px;
        margin-bottom: 2px;
        border-radius: 0 0 4px 0;
        font-weight: bold;
      }
      .badge-hot {
        background: #d9534f;
      }
      .badge-new {
        background: #007bff;
      }
      .badge-sale {
        background: #28a745;
      }

      .card-info {
        padding-right: 5px;
      }
      .scroll-card-title {
        font-size: 0.85rem;
        color: #333;
        height: 2.4em;
        overflow: hidden;
        line-height: 1.2;
        margin: 5px 0;
      }
      .scroll-card-price {
        font-size: 1rem;
        color: var(--accent-color);
        font-weight: 700;
      }

      .add-to-cart-text {
        font-size: 0.9rem;
        font-weight: bold;
        text-decoration: underline;
        padding: 8px 0;
        display: inline-block;
      }

      /* ================= 6. ÊÇ¨ÊµÆË¥≠Áâ©ËΩ¶ÊåâÈíÆ (Floating Cart) ================= */
      .floating-cart-btn {
        position: fixed;
        bottom: 30px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: #000;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        z-index: 990;
        cursor: pointer;
        transition: transform 0.2s;
      }
      .floating-cart-btn:active {
        transform: scale(0.9);
      }
      .floating-cart-icon {
        width: 30px;
        height: 30px;
        filter: invert(1);
      }
      .floating-badge {
        position: absolute;
        top: 0;
        right: 0;
        background: #d9534f;
        color: #fff;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        border: 2px solid #fff;
        font-size: 0.8rem;
      }

      /* ================= 7. ÁΩëÊ†º‰∏éÈÄöÁî® ================= */
      #grid-view {
        display: none;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px 10px;
      }
      .gallery {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }
      @media (min-width: 768px) {
        .gallery {
          grid-template-columns: repeat(4, 1fr);
          gap: 30px;
        }
      }
      .grid-item {
        background: #fff;
        border-radius: 8px;
        border: 1px solid #eee;
        overflow: hidden;
      }
      .grid-add-btn {
        width: 100%;
        background: #000;
        color: #fff;
        padding: 12px 0;
        font-weight: bold;
        border-radius: 4px;
        margin-top: 10px;
        font-size: 1rem;
      }

      /* ================= 8. Modal & Toast ================= */
      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        z-index: 2000;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }
      .modal.open {
        display: flex;
      }
      .modal-content {
        background: #fff;
        width: 100%;
        max-width: 400px;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        animation: popUp 0.3s ease;
      }
      @keyframes popUp {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Â§ßÂ∞∫ÂØ∏Êï∞ÈáèÊéßÂà∂ */
      .qty-control-box {
        display: flex;
        height: 56px;
        border: 2px solid #000;
        border-radius: 8px;
        margin-top: 20px;
      }
      .qty-btn {
        width: 70px;
        background: #000;
        color: #fff;
        font-size: 1.8rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .qty-val {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.4rem;
        font-weight: bold;
      }

      .modal-add-btn {
        width: 100%;
        background: #000;
        color: #fff;
        padding: 18px;
        font-size: 1.2rem;
        border-radius: 8px;
        margin-top: 15px;
        font-weight: bold;
      }

      #toast {
        visibility: hidden;
        background: rgba(0, 0, 0, 0.9);
        color: #fff;
        border-radius: 50px;
        padding: 12px 24px;
        position: fixed;
        left: 50%;
        bottom: 100px;
        transform: translateX(-50%);
        z-index: 9999;
        opacity: 0;
        transition: all 0.3s;
        font-weight: 500;
      }
      #toast.show {
        visibility: visible;
        opacity: 1;
        bottom: 110px;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="header-left" id="menu-trigger">
        <span class="hamburger-icon">‚ò∞</span>
        <span class="menu-text">MENU</span>
      </div>
      <div class="header-center">
        <input
          type="text"
          id="global-search-input"
          class="header-search-input"
          placeholder="Search..."
          autocomplete="off"
        />
        <div id="search-suggestions" class="search-suggestions"></div>
      </div>
      <div class="header-right" onclick="window.location.href='cart.html'">
        <svg
          width="28"
          height="28"
          viewBox="0 0 24 24"
          fill="none"
          stroke="white"
          stroke-width="2"
        >
          <circle cx="9" cy="21" r="1" />
          <circle cx="20" cy="21" r="1" />
          <path
            d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
          />
        </svg>
        <span id="header-cart-count" class="header-cart-badge">0</span>
      </div>
    </header>

    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <div class="sidebar" id="sidebar">
      <div class="sidebar-content">
        <nav>
          <a class="menu-link" onclick="handleMenuClick('Home')">Home</a>
          <a class="menu-link" onclick="handleMenuClick('All')">Shop All</a>
          <a class="menu-link" onclick="handleMenuClick('BestSellers')"
            >Best Sellers üî•</a
          >
          <a class="menu-link" onclick="handleMenuClick('New')"
            >New Arrivals üÜï</a
          >
          <a class="menu-link" href="cart.html">My Cart üõí</a>
        </nav>
        <div
          style="
            margin-top: 20px;
            font-weight: 700;
            color: #999;
            font-size: 0.9rem;
          "
        >
          BRANDS
        </div>
        <div id="sidebar-brands" class="brand-list"></div>
      </div>
    </div>

    <div id="home-view">
      <div id="home-content">
        <div style="padding: 40px; text-align: center; color: #999">
          Loading products...
        </div>
      </div>
    </div>

    <div id="grid-view">
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 15px;
        "
      >
        <h2 id="grid-title" style="margin: 0">Results</h2>
        <button
          onclick="handleMenuClick('Home')"
          style="text-decoration: underline; padding: 5px"
        >
          Back
        </button>
      </div>
      <div class="gallery" id="gallery"></div>
      <div id="pagination" style="text-align: center; margin: 30px 0">
        <button
          id="prev-page"
          style="
            padding: 10px 20px;
            background: #ddd;
            border-radius: 20px;
            margin-right: 10px;
          "
        >
          Prev
        </button>
        <span id="page-info" style="font-weight: bold">1</span>
        <button
          id="next-page"
          style="
            padding: 10px 20px;
            background: #000;
            color: #fff;
            border-radius: 20px;
            margin-left: 10px;
          "
        >
          Next
        </button>
      </div>
    </div>

    <div class="floating-cart-btn" onclick="window.location.href='cart.html'">
      <svg
        class="floating-cart-icon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="black"
        stroke-width="2"
      >
        <circle cx="9" cy="21" r="1" />
        <circle cx="20" cy="21" r="1" />
        <path
          d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
        />
      </svg>
      <span class="floating-badge" id="float-cart-count">0</span>
    </div>

    <div id="modal" class="modal">
      <div class="modal-content">
        <div
          onclick="closeModal()"
          style="
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            text-align: center;
            line-height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
          "
        >
          &times;
        </div>
        <img
          id="modal-img"
          src=""
          style="
            width: 100%;
            height: 300px;
            object-fit: cover;
            background: #eee;
          "
        />
        <div style="padding: 20px">
          <h3 id="modal-title" style="margin: 0 0 5px"></h3>
          <div
            id="modal-sub"
            style="color: #666; font-size: 0.9rem; margin-bottom: 15px"
          ></div>
          <div
            id="modal-price"
            style="
              font-size: 1.5rem;
              color: var(--accent-color);
              font-weight: bold;
            "
          ></div>
          <div id="modal-action-area"></div>
        </div>
      </div>
    </div>

    <div id="toast">Added to Cart! üõí</div>

    <script src="db.js"></script>
    <script>
      // ================= ÈÖçÁΩÆ =================
      const FEATURED_BRANDS = [
        "Creed",
        "Dior",
        "Chanel",
        "Tom Ford",
        "Yves Saint Laurent",
        "Louis Vuitton",
        "Gucci",
        "Burberry",
        "Versace",
        "Maison Francis Kurkdjian",
        "Parfums de Marly",
        "Jean Paul Gaultier",
        "Other",
      ];
      let cartItems = [];
      let currentPage = 1;
      let currentGridData = [];
      let viewMode = "home";

      // ================= ÂàùÂßãÂåñ =================
      document.addEventListener("DOMContentLoaded", () => {
        loadCart();
        setupSidebar();
        setupSearch();
        setupScrollRestoration();

        // Ê®°ÊãüÁ≠âÂæÖ DB Âä†ËΩΩ
        const checkDB = setInterval(() => {
          if (window.perfumeDB) {
            clearInterval(checkDB);
            // Â¶ÇÊûú sessionStorage ÊúâÁä∂ÊÄÅÂàôÊÅ¢Â§çÔºåÂê¶ÂàôÊ∏≤ÊüìÈ¶ñÈ°µ
            if (!restoreState()) {
              renderHome();
            }
          }
        }, 50);
      });

      // ================= 1. È™®Êû∂Â±è‰∏éÂõæÁâáÊáíÂä†ËΩΩ =================
      function createImgHtml(src, alt) {
        // ËøîÂõûÂåÖÂê´ Skeleton Ê†∑ÂºèÁöÑ HTML ÁªìÊûÑ
        // onerror Â¢ûÂä†ÂõûÈÄÄÂ§ÑÁêÜ
        return `
          <div class="img-wrapper skeleton">
            <img src="${src}" alt="${alt}" loading="lazy" 
              onload="this.parentElement.classList.remove('skeleton'); this.classList.add('loaded')"
              onerror="this.src='https://via.placeholder.com/150?text=No+Image'; this.parentElement.classList.remove('skeleton'); this.classList.add('loaded')"
            >
          </div>
        `;
      }

      // ================= 2. ÊêúÁ¥¢Â¢ûÂº∫ (ÂÆûÊó∂ + Debounce) =================
      function debounce(func, wait) {
        let timeout;
        return function (...args) {
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(this, args), wait);
        };
      }

      function setupSearch() {
        const input = document.getElementById("global-search-input");
        const suggestBox = document.getElementById("search-suggestions");

        input.addEventListener(
          "input",
          debounce((e) => {
            const val = e.target.value.trim().toLowerCase();
            if (!val) {
              suggestBox.style.display = "none";
              return;
            }

            const matches = window.perfumeDB
              .filter(
                (p) =>
                  p.name.toLowerCase().includes(val) ||
                  p.brand.toLowerCase().includes(val) ||
                  (p.id && p.id.toString().includes(val))
              )
              .slice(0, 6); // ÈôêÂà∂ÊòæÁ§∫6Êù°

            if (matches.length > 0) {
              suggestBox.innerHTML = matches
                .map(
                  (p) => `
              <div class="suggestion-item" onclick="openModalById('${p.id}'); document.getElementById('search-suggestions').style.display='none'">
                <img src="${p.img}" class="suggestion-thumb" loading="lazy">
                <div class="suggestion-text">
                  <div style="font-weight:bold; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; width:100%">${p.name}</div>
                  <div style="color:#666; font-size:0.8rem">${p.brand}</div>
                </div>
              </div>
            `
                )
                .join("");
              suggestBox.style.display = "block";
            } else {
              suggestBox.style.display = "none";
            }
          }, 300)
        );

        // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠Âª∫ËÆÆ
        document.addEventListener("click", (e) => {
          if (!e.target.closest(".header-center"))
            suggestBox.style.display = "none";
        });

        // ÂõûËΩ¶‰ªçË∑≥ËΩ¨ÁΩëÊ†º
        input.addEventListener("change", (e) => {
          if (e.target.value) switchToGrid("Search:" + e.target.value);
        });
      }

      // ================= 3. È¶ñÈ°µÊ∏≤Êüì (Âê´ÊªöÂä®ÁÆ≠Â§¥) =================
      function renderHome() {
        const container = document.getElementById("home-content");
        container.innerHTML = "";
        const db = window.perfumeDB || [];

        // ËæÖÂä©ÔºöÁîüÊàêÂç°ÁâáHTML
        const renderCard = (p) => `
          <div class="scroll-card" oncontextmenu="return false;" 
               ontouchstart="handleTouchStart(event, '${p.id}')" 
               ontouchend="handleTouchEnd(event, '${p.id}')"
               onmousedown="handleMouseDown(event, '${p.id}')"
               onmouseup="handleMouseUp(event, '${p.id}')"
               onclick="handleClick(event, '${p.id}')">
             <div class="badges-container">
               ${
                 p.top == 1
                   ? '<span class="badge-tag badge-hot">HOT</span>'
                   : ""
               }
               ${
                 p.new == 1
                   ? '<span class="badge-tag badge-new">NEW</span>'
                   : ""
               }
               ${
                 p.sale == 1
                   ? '<span class="badge-tag badge-sale">SALE</span>'
                   : ""
               }
             </div>
             ${createImgHtml(p.img, p.name)}
             <div class="card-info">
               <div class="scroll-card-title">${p.name}</div>
               <div class="scroll-card-price">$${p.price}</div>
               <div class="add-to-cart-text">Add to Cart</div>
             </div>
          </div>
        `;

        // ËæÖÂä©ÔºöÂàõÂª∫Â∏¶ÁÆ≠Â§¥ÁöÑÊùøÂùó
        const createSection = (title, items, linkKey) => {
          const section = document.createElement("div");
          section.className = "brand-section";
          section.id = "anchor-" + linkKey.replace(/\s+/g, "");

          const wrapperId = `scroll-${Math.random().toString(36).substr(2, 9)}`;

          section.innerHTML = `
            <div class="brand-header">
              <h2 class="brand-title">${title}</h2>
              <div onclick="switchToGrid('${linkKey}')" style="font-size:0.85rem; color:#666; text-decoration:underline;">See All ></div>
            </div>
            <div class="scroll-container-wrapper">
              <button class="scroll-nav-btn left" onclick="scrollRef('${wrapperId}', -200)">&#8249;</button>
              <div class="scroll-wrapper" id="${wrapperId}">
                 ${items.slice(0, 15).map(renderCard).join("")}
                 <div class="scroll-card" style="justify-content:center; align-items:center; color:#666;" onclick="switchToGrid('${linkKey}')">
                    <span>View All</span>
                    <span style="font-size:1.5rem">‚Üí</span>
                 </div>
              </div>
              <button class="scroll-nav-btn right" onclick="scrollRef('${wrapperId}', 200)">&#8250;</button>
            </div>
          `;
          return section;
        };

        // 1. Best Sellers
        const best = db.filter((p) => p.top == 1);
        if (best.length)
          container.appendChild(
            createSection("üî• Best Sellers", best, "BestSellers")
          );

        // 2. Brands
        const rendered = new Set();
        FEATURED_BRANDS.forEach((brand) => {
          let items;
          if (brand === "Other") {
            items = db.filter(
              (p) =>
                !rendered.has(p.brand) && !FEATURED_BRANDS.includes(p.brand)
            ); // Simplified logic
          } else {
            items = db.filter((p) =>
              p.brand.toLowerCase().includes(brand.toLowerCase())
            );
            items.forEach(() => rendered.add(brand)); // Track logical brands
          }

          if (items.length >= 3) {
            container.appendChild(
              createSection(brand.toUpperCase(), items, brand)
            );
          }
        });
      }

      window.scrollRef = function (id, offset) {
        const el = document.getElementById(id);
        if (el) el.scrollBy({ left: offset, behavior: "smooth" });
      };

      // ================= 4. ÈïøÊåâ‰∫§‰∫íÈÄªËæë (Long Press) =================
      let pressTimer;
      let isLongPress = false;

      window.handleTouchStart = (e, id) => {
        isLongPress = false;
        pressTimer = setTimeout(() => {
          isLongPress = true;
          navigator.vibrate && navigator.vibrate(50); // ÈúáÂä®ÂèçÈ¶à
          addToCart(id); // ÈïøÊåâÁõ¥Êé•Âä†Ë¥≠Áâ©ËΩ¶
        }, 600);
      };

      window.handleTouchEnd = () => clearTimeout(pressTimer);

      // Desktop Mouse events simulating long press
      window.handleMouseDown = (e, id) => {
        isLongPress = false;
        pressTimer = setTimeout(() => {
          isLongPress = true;
          addToCart(id);
        }, 600);
      };
      window.handleMouseUp = () => clearTimeout(pressTimer);

      window.handleClick = (e, id) => {
        if (isLongPress) return; // Â¶ÇÊûúËß¶Âèë‰∫ÜÈïøÊåâÔºåÂàô‰∏çËß¶ÂèëÁÇπÂáª
        // Âè™ÊúâÁÇπÂáª"Add to Cart"ÊñáÊú¨Êó∂ÊâçÂä†Ë¥≠ÔºåÂê¶ÂàôÂºÄÂºπÁ™ó
        if (e.target.classList.contains("add-to-cart-text")) {
          addToCart(id);
        } else {
          openModalById(id);
        }
      };

      // ================= 5. Grid View & State =================
      window.switchToGrid = function (criteria) {
        saveState(); // Á¶ªÂºÄÂâç‰øùÂ≠ò
        viewMode = "grid";
        document.getElementById("home-view").style.display = "none";
        document.getElementById("grid-view").style.display = "block";
        window.scrollTo(0, 0);

        const db = window.perfumeDB;
        let filtered = [];
        let title = criteria;

        if (criteria === "All") filtered = db;
        else if (criteria === "BestSellers")
          filtered = db.filter((p) => p.top == 1);
        else if (criteria === "New") filtered = db.filter((p) => p.new == 1);
        else if (criteria.startsWith("Search:")) {
          const term = criteria.replace("Search:", "").toLowerCase();
          filtered = db.filter(
            (p) =>
              p.name.toLowerCase().includes(term) ||
              p.brand.toLowerCase().includes(term)
          );
          title = `Results: "${term}"`;
        } else {
          filtered = db.filter((p) => p.brand.includes(criteria));
        }

        currentGridData = filtered;
        currentPage = 1;
        document.getElementById("grid-title").textContent = title;
        renderGrid();
      };

      function renderGrid() {
        const gallery = document.getElementById("gallery");
        gallery.innerHTML = "";
        const start = (currentPage - 1) * 20;
        const pageData = currentGridData.slice(start, start + 20);

        if (!pageData.length)
          gallery.innerHTML =
            "<div style='grid-column:1/-1;padding:20px;text-align:center'>No items found.</div>";

        pageData.forEach((p) => {
          const div = document.createElement("div");
          div.className = "grid-item";
          div.innerHTML = `
            <div style="position:relative" onclick="openModalById('${p.id}')">
              ${createImgHtml(p.img, p.name)}
              ${
                p.top == 1
                  ? '<span style="position:absolute;top:0;left:0;background:red;color:white;padding:2px 5px;font-size:0.7rem">HOT</span>'
                  : ""
              }
            </div>
            <div style="padding:10px;">
               <div style="height:2.4em;overflow:hidden;font-size:0.9rem;line-height:1.2;margin-bottom:5px;">${
                 p.name
               }</div>
               <div style="font-weight:bold;color:#b28900;">$${p.price}</div>
               <button class="grid-add-btn" onclick="addToCart('${
                 p.id
               }')">ADD TO CART</button>
            </div>
          `;
          gallery.appendChild(div);
        });

        // Pagination logic (simplified)
        document.getElementById("page-info").textContent = `${currentPage} / ${
          Math.ceil(currentGridData.length / 20) || 1
        }`;
      }

      document.getElementById("prev-page").onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          renderGrid();
          window.scrollTo(0, 0);
        }
      };
      document.getElementById("next-page").onclick = () => {
        if (currentPage < Math.ceil(currentGridData.length / 20)) {
          currentPage++;
          renderGrid();
          window.scrollTo(0, 0);
        }
      };

      // ================= 6. Áä∂ÊÄÅ‰øùÊåÅ (SessionStorage) =================
      function saveState() {
        sessionStorage.setItem("perfume_posY", window.scrollY);
        sessionStorage.setItem("perfume_view", viewMode);
      }

      function restoreState() {
        const savedView = sessionStorage.getItem("perfume_view");
        const savedY = sessionStorage.getItem("perfume_posY");

        if (savedView === "grid") {
          // Â¶ÇÊûú‰∏äÊ¨°ÊòØ GridÔºåËøôÈáå‰∏∫‰∫ÜÁÆÄÂçïÁõ¥Êé•ÂõûÈ¶ñÈ°µÔºåÊàñËÄÖ‰Ω†ÂèØ‰ª•ÂÆûÁé∞ÊÅ¢Â§ç Grid ÂèÇÊï∞ÁöÑÈÄªËæë
          // ËøôÈáåÊàë‰ª¨ÁÆÄÂçïÂ§ÑÁêÜÔºöÂ¶ÇÊûúÊúâ‰øùÂ≠ò‰ΩçÁΩÆÔºå‰∏îÊòØhomeÔºåÂàôÊÅ¢Â§çÊªöÂä®
          renderHome();
          return false;
        } else {
          renderHome();
          if (savedY)
            setTimeout(() => window.scrollTo(0, parseInt(savedY)), 100);
          return true;
        }
      }

      // ÁõëÂê¨Á¶ªÂºÄÈ°µÈù¢‰∫ã‰ª∂
      window.addEventListener("beforeunload", saveState);

      // ================= 7. ÈÄöÁî®ÈÄªËæë =================
      function setupSidebar() {
        // ÁîüÊàê‰æßËæπÊ†èÂìÅÁâåÈìæÊé•
        const list = document.getElementById("sidebar-brands");
        FEATURED_BRANDS.forEach((b) => {
          const div = document.createElement("div");
          div.className = "brand-item";
          div.textContent = b;
          div.onclick = () => {
            document.getElementById("sidebar").classList.remove("active");
            document
              .getElementById("sidebar-overlay")
              .classList.remove("active");
            window.scrollToBrand(b);
          };
          list.appendChild(div);
        });

        // ÁªëÂÆöÂºÄÂÖ≥
        const toggle = () => {
          document.getElementById("sidebar").classList.toggle("active");
          document.getElementById("sidebar-overlay").classList.toggle("active");
        };
        document.getElementById("menu-trigger").onclick = toggle;
        document.getElementById("sidebar-overlay").onclick = toggle;
      }

      window.scrollToBrand = (brand) => {
        if (viewMode !== "home") {
          document.getElementById("grid-view").style.display = "none";
          document.getElementById("home-view").style.display = "block";
          viewMode = "home";
        }
        setTimeout(() => {
          const id = "anchor-" + brand.replace(/\s+/g, "");
          const el = document.getElementById(id);
          if (el) {
            const y = el.getBoundingClientRect().top + window.pageYOffset - 65;
            window.scrollTo({ top: y, behavior: "smooth" });
          } else {
            switchToGrid(brand);
          }
        }, 100);
      };

      window.handleMenuClick = (action) => {
        document.getElementById("sidebar").classList.remove("active");
        document.getElementById("sidebar-overlay").classList.remove("active");
        if (action === "Home") {
          viewMode = "home";
          document.getElementById("home-view").style.display = "block";
          document.getElementById("grid-view").style.display = "none";
          window.scrollTo(0, 0);
        } else {
          switchToGrid(action);
        }
      };

      // Ë¥≠Áâ©ËΩ¶ÈÄªËæë
      window.addToCart = (id) => {
        const product = window.perfumeDB.find((p) => p.id == id);
        if (!product) return;
        const exist = cartItems.find((c) => c.name == id);
        if (exist) exist.quantity++;
        else
          cartItems.push({
            name: id,
            caption: product.name,
            img: product.img,
            price: product.price,
            quantity: 1,
          });

        saveCart();
        showToast(`Added: ${product.name}`);
        if (document.getElementById("modal").classList.contains("open"))
          updateModalBtn(id);
      };

      function saveCart() {
        localStorage.setItem("perfumeCart", JSON.stringify(cartItems));
        updateCartCount();
      }
      function loadCart() {
        cartItems = JSON.parse(localStorage.getItem("perfumeCart") || "[]");
        updateCartCount();
      }
      function updateCartCount() {
        const count = cartItems.reduce((s, i) => s + i.quantity, 0);
        document.getElementById("header-cart-count").textContent = count;
        document.getElementById("float-cart-count").textContent = count;
      }
      function showToast(msg) {
        const t = document.getElementById("toast");
        t.textContent = msg;
        t.classList.add("show");
        setTimeout(() => t.classList.remove("show"), 2000);
      }

      // Modal ÈÄªËæë
      window.openModalById = (id) => {
        const p = window.perfumeDB.find((x) => x.id == id);
        if (!p) return;
        document.getElementById("modal-img").src = p.img;
        document.getElementById("modal-title").textContent = p.name;
        document.getElementById("modal-sub").textContent = `${
          p.brand
        } | Size: ${p.ml || "N/A"}ml`;
        document.getElementById("modal-price").textContent = `$${p.price}`;
        updateModalBtn(id);
        document.getElementById("modal").classList.add("open");
      };
      window.closeModal = () =>
        document.getElementById("modal").classList.remove("open");

      function updateModalBtn(id) {
        const item = cartItems.find((c) => c.name == id);
        const area = document.getElementById("modal-action-area");
        if (!item) {
          area.innerHTML = `<button class="modal-add-btn" onclick="addToCart('${id}')">ADD TO CART</button>`;
        } else {
          area.innerHTML = `
            <div class="qty-control-box">
               <div class="qty-btn" onclick="modQty('${id}', -1)">-</div>
               <div class="qty-val">${item.quantity}</div>
               <div class="qty-btn" onclick="modQty('${id}', 1)">+</div>
            </div>
          `;
        }
      }
      window.modQty = (id, d) => {
        const i = cartItems.find((c) => c.name == id);
        if (i) {
          i.quantity += d;
          if (i.quantity <= 0)
            cartItems = cartItems.filter((c) => c.name != id);
          saveCart();
          updateModalBtn(id);
        }
      };
    </script>
  </body>
</html>
